<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="assignment-admin">
    <style>
        .list {
            padding: 0;
            /* 		border-right: 1px solid #ccc; */
        }

        .list paper-item {
            min-height: 80px;
            border-bottom: 1px solid #dedede;
            background-color: #fafafa;
        }

        #todoEntry {
            background-color: #eee;
            margin: 0;
            width: 100%;
            max-width: none;
            border-bottom: 1px solid #ccc;
        }

        paper-input {
            margin: 0 4vw;
            padding: 0;
        }

        paper-material {
            background-color: #fff;
            max-width: 640px;
            width: 95%;
            margin: 25px auto;
            position: relative;
        }

        #todos {
            overflow-y: scroll;
            height: 66vh;
        }

        #todos {
            overflow-y: scroll;
        }

        paper-fab {
            position: absolute;
            background: #00BCD4;
            bottom: 2vh;
            right: 2vw;
        }

        .main-panel {
            background-color: #eee;
            height: 100vh;
            overflow-y: hidden;
        }

        .task-empty paper-item {
            text-align: center;
            padding: 25px;
            color: #6f6f6f;
        }

        paper-toolbar {
            background: #D32F2F;
        }

        #made-with {
            width: 100%;
            margin: 0;
            position: fixed;
            bottom: 0;
            text-align: center;
        }

        #made-with img {
            width: 35%;
            padding: 10px;
        }
    </style>


    <template>
            <paper-drawer-panel>
                <paper-header-panel drawer>
                    <paper-toolbar>
                        <paper-item>Side Bar Title</paper-item>
                    </paper-toolbar>
                    <!-- Side Bar Content -->
                    Some sample side bar content.
                    <paper-menu class="list">
                        <template is="dom-if" if="{{!done.length}}">
                            <paper-material>
                                <paper-item>Completed tasks will appear here!</paper-item>
                            </paper-material>
                        </template>
                        <template id="done" is="dom-repeat" items="{{done}}">
                            <paper-item>{{item.task}}<i style="margin-left: 5px;">{{item.user}}</i></paper-item>
                        </template>
                    </paper-menu>
                </paper-header-panel>
                <paper-header-panel main class="main-panel">
                    <paper-toolbar>
                        <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                        <paper-item>
                            <iron-icon icon="icons:face"></iron-icon>
                            <span id="here">0</span>
                        </paper-item>
                        <paper-item>Active Tasks</paper-item>
                    </paper-toolbar>
                    <!-- Body of Element -->
        <div style="border-left: 1px solid #ccc;" >

            <paper-material id="todoEntry" elevation="2" >
                <paper-input label="Assignment Name" value="{{name::input}}"></paper-input>
                <paper-item>
                    <div>
                        <paper-button class="btn" on-tap="showDialogEffective" raised>Effective Date</paper-button>
                        {{dateFormat(effectiveDate, 'LL')}}
                    </div>
                </paper-item>
                <paper-item>
                    <div>
                        <paper-button class="btn" on-tap="showDialogExpiry" raised>Expiration Date</paper-button>
                        {{dateFormat(expirationDate, 'LL')}}
                    </div>
                </paper-item>
            </paper-material>

            <paper-dialog id="dialog" class="paper-date-picker-dialog" modal on-iron-overlay-closed="dismissDialog">
                <paper-date-picker id="picker" date="{{date}}"></paper-date-picker>
                <div class="buttons">
                    <paper-button dialog-dismiss>Cancel</paper-button>
                    <paper-button dialog-confirm>OK</paper-button>
                </div>
            </paper-dialog>

            <template is="dom-repeat" items="{{words}}">
                <paper-material>
                    <paper-item>
                        <paper-item-body hidden={{item.editing}} three-line class="layout vertical">
                            <div>{{item.word}}</div>
                            <div secondary>{{item.sentence}}</div>
                        </paper-item-body>
                        <paper-item-body hidden={{!item.editing}} three-line class="layout vertical">
                            <paper-input label="Spelling Word" value="{{item.word::input}}"></paper-input>
                            <paper-input label="Example usage in sentence" value="{{item.sentence::input}}"></paper-input>
                        </paper-item-body>
                        <paper-fab hidden={{item.editing}} mini icon="editor:mode-edit" on-tap="doEdit"></paper-fab>
                        <paper-fab hidden={{!item.editing}} mini icon="icons:done" on-tap="doEdit"></paper-fab>
                    </paper-item>
                </paper-material>
            </template>
            <paper-item-body three-line class="layout vertical">
                <paper-dialog-scrollable>{{JSON}}</paper-dialog-scrollable>
            </paper-item-body>
        </div>
        </paper-header-panel>
        </paper-drawer-panel>
    </template>

    <script>
        Polymer({
            is: 'assignment-admin',
            properties: {
                name: "",
                words: [],
                effectiveDate: "",
                expirationDate: "",
                JSON: {
                    type: String,
                    computed: "getJson(name, words, effectiveDate, expirationDate)"
                    }
            },
            ready: function () {
                this.name = "Sample Name";
                this.words = [
                    { word: "Rat", sentence: "The rat darted across the alleyway", editing: false },
                    { word: "Cat", sentence: "The cat sleeps all day long.", editing: false },
                    { word: "Fat", sentence: "You eat too much, you get fat.", editing: false }
                ];
                this.effectiveDate = new Date();
                this.expirationDate = new Date();
                this.whichDateAmIModifying = "";
            },
            observers: [
                'getJson(words.*)'
            ],
            dateFormat: function (date, format) {
                return moment(date).format(format);
            },
            dismissDialog: function (event) {
                if (event.detail.confirmed) {
                    if (this.whichDataAmIModifying == 'Effective')
                        this.effectiveDate = this.$.picker.date;
                    else
                        this.expirationDate = this.$.picker.date;
                }
            },
            showDialogEffective: function () {
                this.whichDataAmIModifying = 'Effective';
                this.$.dialog.toggle();
            },
            showDialogExpiry: function () {
                this.whichDataAmIModifying = 'Expiry';
                this.$.dialog.toggle();
            },
            doEdit: function (e) {
                var model = e.model;
                model.set('item.editing', !model.item.editing);
            },
            getJson: function () {
                var myObj = {
                    name: this.name,
                    words: this.words,
                    effectiveDate: this.effectiveDate,
                    expirationDate: this.expirationDate
                }
                console.log(JSON.stringify(myObj));
                return JSON.stringify(myObj);
            }

        });
    </script>

</dom-module>
